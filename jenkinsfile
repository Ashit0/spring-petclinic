pipeline{
    agent{
        label 'JDK_17'
    }
    triggers{ pollSCM( '* * * * *') }
    stages{
        stage('vcs'){
            steps{
            git url: 'https://github.com/Ashit0/spring-petclinic.git',
                branch: 'release'
            } 
        } 
        stage('Post build'){
            steps{
                archiveArtifacts artifacts: '**/target/spring-petclinic-3.0.0-SNAPSHOT.jar',
                                 onlyIfSuccessful:true
                junit testResults: '**/surefire-reports/TEST-*.xml'                 
            }

        }
        stage('Sonar analysis'){
            steps{
                withSonarQubeEnv('SONAR_CLOUD'){
                    sh './mvnw clean package sonar:sonar \
                        -Dsonar.login=c45d5483f45a3dd0809ee3a87af7c32c1349cc6e \
                       -Dsonar.host.url=https://sonarcloud.io \
                        -Dsonar.organization=ashit \
                         -Dsonar.projectKey=ashit_ashit-project'
                }
            }
        }
        
    }

}